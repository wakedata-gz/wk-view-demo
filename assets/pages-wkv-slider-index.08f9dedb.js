import{_ as e}from"./wk-section.6cd0c367.js";import{_ as t,j as a,s as n,r as s,v as l,G as o,o as u,c as d,w as r,e as i,m as c,u as m,f as p,t as f,n as v,i as h,d as g,h as k}from"./index-f01243c1.js";import{r as w}from"./uni-app.es.81331c7f.js";const _=new WeakMap,V={onTrack(e,t,a){let n=0,s=0,l=0,o=0;const u=function(e,a,u,d){if(!1===t({target:e.target,currentTarget:e.currentTarget,preventDefault:e.preventDefault.bind(e),stopPropagation:e.stopPropagation.bind(e),touches:e.touches,changedTouches:e.changedTouches,detail:{state:a,x:u,y:d,dx:u-n,dy:d-s,ddx:u-l,ddy:d-o,timeStamp:e.timeStamp}}))return!1};let d,r,i,c=null;x(e,"touchstart",(function(e){if(r=!0,1===e.touches.length&&!c)return c=e,n=l=e.touches[0].pageX,s=o=e.touches[0].pageY,u(e,"start",n,s)})),x(e,"mousedown",(function(e){if(i=!0,!r&&!c)return c=e,n=l=e.pageX,s=o=e.pageY,u(e,"start",n,s)})),x(e,"touchmove",(function(e){if(1===e.touches.length&&c){const t=u(e,"move",e.touches[0].pageX,e.touches[0].pageY);return l=e.touches[0].pageX,o=e.touches[0].pageY,t}}));const m=function(e){e.preventDefault(),e.stopPropagation()},p=function(e){if(!r&&i&&c){!d&&(Math.abs(l-n)>2||Math.abs(o-s)>2)&&(document.addEventListener("click",m,!0),d=!0);const t=u(e,"move",e.pageX,e.pageY);return l=e.pageX,o=e.pageY,t}};document.addEventListener("mousemove",p),x(e,"touchend",(function(e){if(0===e.touches.length&&c)return r=!1,c=null,u(e,"end",e.changedTouches[0].pageX,e.changedTouches[0].pageY)}));const f=t=>{if(i=!1,!r&&c)return d&&setTimeout((()=>{document.removeEventListener("click",_.get(e).clickEventListener,!0),d=!1}),0),c=null,u(t,"end",t.pageX,t.pageY)};document.addEventListener("mouseup",f),_.set(e,{clickEventListener:m,mouseMoveEventListener:p,mouseUpEventListener:f}),x(e,"touchcancel",(function(e){if(c){r=!1;const t=c;return c=null,u(e,a?"cancel":"end",t.touches[0].pageX,t.touches[0].pageY)}}))},offTrack(e){const{mouseMoveEventListener:t,mouseUpEventListener:a}=_.get(e)||{};document.removeEventListener("mousemove",t),document.removeEventListener("mouseup",a)}},x=function(e,t,a,n){e.addEventListener(t,(e=>{"function"==typeof a&&!1===a(e)&&(e.preventDefault(),e.stopPropagation())}),{capture:n,passive:!1})},b=t({__name:"wkv-slider",props:{min:{type:Number,default:0},max:{type:Number,default:100},step:{type:Number,default:1},disabled:{type:Boolean,default:!1},modelValue:{type:Number,default:0}},emits:["update:modelValue"],setup(e,{emit:t}){const g=e,k=a((()=>{const{modelValue:e,min:t,max:a}=g;return(e-t)/(a-t)*100+"%"})),w=a((()=>g.max.toString().length/1.5+"em"));n((()=>g.modelValue),(()=>{const{min:e,max:a,step:n,modelValue:s}=g,l=y(s);l!==s&&console.warn(`${s} 不在有效范围 [${e},${a}](步长 ${n})，自动重置为 ${l}`),t("update:modelValue",l)}),{immediate:!0}),n((()=>[g.min,g.max,g.step]),(()=>{const{min:e,max:t,step:a}=g;Number.isInteger((t-e)/a)||console.warn("step 取值必须大于 0，并且可被 (max - min) 整除")}),{immediate:!0});const _=`wkv-slider-handler-${Math.random().toString().slice(2)}`,x=s({left:0,width:0});l((()=>{const e=document.getElementById(_);x.value={left:e.offsetLeft,width:e.clientWidth},V.onTrack(document.getElementById(_),b)})),o((()=>{V.offTrack(document.getElementById(_))}));const b=e=>{if(g.disabled)return;if(!["start","move"].includes(e.detail.state))return;const{left:a,width:n}=x.value,s=(e.detail.x-a)/n,{min:l,max:o,step:u}=g,d=Math.floor((o-l)*s+l);t("update:modelValue",y(d))};function y(e){const{min:t,max:a,step:n}=g;return e=Math.max(Math.min(e,a),t),e=Math.floor((e-t)/n)*n+t}return(t,a)=>{const n=h;return u(),d(n,{class:v({"wkv-slider":!0,"wkv-slider--disabled":e.disabled}),style:c({"--wkv-slider-progress":m(k)})},{default:r((()=>[i(n,{class:"wkv-slider-handler",id:_},{default:r((()=>[i(n,{class:"wkv-slider-handler__track"}),i(n,{class:"wkv-slider-handler__thumb"})])),_:1}),i(n,{class:"wkv-slider-value",style:c({"--wkv-slider-value-width":m(w)})},{default:r((()=>[p(f(e.modelValue),1)])),_:1},8,["style"])])),_:1},8,["class","style"])}}},[["__scopeId","data-v-ab69675d"]]),y=t(g({__name:"index",setup(t){const a=s(66),n=s(8),l=s(30),o=s(50);return(t,s)=>{const c=w(k("wk-section"),e),m=w(k("wkv-slider"),b),f=h;return u(),d(f,{class:"wkv-slider-example"},{default:r((()=>[i(c,null,{default:r((()=>[p("默认")])),_:1}),i(m,{modelValue:a.value,"onUpdate:modelValue":s[0]||(s[0]=e=>a.value=e)},null,8,["modelValue"]),i(c,null,{default:r((()=>[p("最小值/最大值")])),_:1}),i(m,{min:5,max:10,modelValue:n.value,"onUpdate:modelValue":s[1]||(s[1]=e=>n.value=e)},null,8,["modelValue"]),i(c,null,{default:r((()=>[p("步长")])),_:1}),i(m,{step:10,modelValue:l.value,"onUpdate:modelValue":s[2]||(s[2]=e=>l.value=e)},null,8,["modelValue"]),i(c,null,{default:r((()=>[p("禁用")])),_:1}),i(m,{disabled:"",modelValue:o.value,"onUpdate:modelValue":s[3]||(s[3]=e=>o.value=e)},null,8,["modelValue"])])),_:1})}}}),[["__scopeId","data-v-c24c6632"]]);export{y as default};
